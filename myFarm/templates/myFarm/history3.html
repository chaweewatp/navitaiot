<!DOCTYPE html>
{% load static %}

<html lang="en">
<head>
    <meta charset="UTF-8">
    {#    <link rel="stylesheet" href="{% static  'css/landingPage.css' %}">#}
    {#    <link rel="stylesheet" href="{% static 'css/landingPageFonts.css' %}">#}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="http://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.js"></script>
    <link href="http://cdn.jsdelivr.net/timepicker.js/latest/timepicker.min.css" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="../../../../static/js/Chart.js"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap-clockpicker.min.css' %}">

    <title>Title</title>

    <style>
        .block {
            padding: 30px;
            text-align: center;
        }

        .y {
            background: yellow;
        }

        .r {
            background: red;
        }

        .b {
            background: lightblue;
        }

        .g {
            background: lightgreen;
        }

    </style>


    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            -webkit-transition: .4s;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }
    </style>


</head>
<body>

<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.0.1/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-analytics.js"></script>


<div class="body">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12">
                <div class="row">
                    <div class="col-xs-12">
                        <label>
                            Enter date:
                            <input type="date" id="selectedDate">
                        </label>
                        <button onclick="getDate()">Submit</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <canvas id="myChart" width="400" height="400"></canvas>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4">
                <table id="table_div1" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay1</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>

                    <tbody></tbody>
                </table>
            </div>
            <div class="col-xs-4">
                <table id="table_div2" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay2</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="col-xs-3">
                <table id="table_div3" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay3</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-4">
                <table id="table_div4" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay4</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="col-xs-4">
                <table id="table_div5" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay5</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <div class="col-xs-3">
                <table id="table_div6" class="table table-striped">
                    <thead>
                    <tr>
                        <th>Relay6</th>
                        <th>type</th>
                        <th>operation</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{# table #}
<script>


</script>

{# control relay#}
<script>

</script>

{# Schedule set#}
<script>

</script>


{# schedule Edit#}
<script>

</script>

{#  <script src="../../static/js/vendor/modernizr-3.8.0.min.js"></script>#}
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
{#  <script>window.jQuery || document.write('<script src="./js/vendor/jquery-3.4.1.min.js"><\/script>')</script>#}
{#  <script src="../../static/js/plugins.js"></script>#}
{#<script src="{% static 'js/main.js' %}"></script>#}
{#  <script src="../../static/js/main.js"></script>#}

<script>
    var today = new Date()
    d = (today.getDate()).toString()
    m = (today.getMonth() + 1).toString()
    y = (today.getFullYear()).toString()


    function convUnixToHMS(t) {
        date = new Date(t * 1000);
        var hours = date.getHours();
        // Minutes part from the timestamp
        var minutes = "0" + date.getMinutes();
        // Seconds part from the timestamp
        var seconds = "0" + date.getSeconds();

        // Will display time in 10:30:23 format
        var formattedTime = hours + ':' + minutes.substr(-2) + ':' + seconds.substr(-2);

        return formattedTime

    }

    function getDate() {
        console.log('button click')
        var input = document.getElementById('selectedDate').value;
        var x = new Date(input);
        {#console.log(x)#}
        y = x.getFullYear()
        m = x.getMonth() + 1
        d = x.getDate()

        var dataArray = [];
        var btc = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/boardTemp/history2/" + y + "/" + m + "/" + d);
        btc.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[0] = {
                data: genData(arr2),
                label: "Baord Temperature",
                borderColor: "#3e95cd",
                fill: false
            }

        })

        var bhc = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/boardHumi/history2/" + y + "/" + m + "/" + d);
        bhc.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[1] = {
                data: genData(arr2),
                label: "Board humidity",
                borderColor: "#FFFF00",
                fill: false
            }
        });

        var atc = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/airTemp/history2/" + y + "/" + m + "/" + d);
        atc.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[2] = {
                data: genData(arr2),
                label: "Air Temperature",
                borderColor: "#00FF00",
                fill: false
            }

        });

        var ahc = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/airHumid/history2/" + y + "/" + m + "/" + d);
        ahc.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[3] = {
                data: genData(arr2),
                label: "Air Humidity",
                borderColor: "#AA0000",
                fill: false
            }

        });

        var sc1 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/soil1A/history2/" + y + "/" + m + "/" + d);
        sc1.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[4] = {
                data: genData(arr2),
                label: "Soil humidity 1",
                borderColor: "#AA00FF",
                fill: false
            }

        });

        var sc2 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/soil2A/history2/" + y + "/" + m + "/" + d);
        sc2.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[5] = {
                data: genData(arr2),
                label: "Soil humidity 2",
                borderColor: "#FF00AA",
                fill: false
            }

        });

        var sc3 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/soil3A/history2/" + y + "/" + m + "/" + d);
        sc3.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[6] = {
                data: genData(arr2),
                label: "Soil humidity 3",
                borderColor: "#AAFFAA",
                fill: false
            }

        });

        var fs1 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/flowSen1/history2/" + y + "/" + m + "/" + d);
        fs1.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[7] = {
                data: genData(arr2),
                label: "Flow sensor 1",
                borderColor: "#AA00FF",
                fill: false
            }

        });

        var fs2 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/flowSen2/history2/" + y + "/" + m + "/" + d);
        fs2.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[8] = {
                data: genData(arr2),
                label: "Flow sensor 2",
                borderColor: "#FF00AA",
                fill: false
            }

        });

        var fs3 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/sensors/flowSen3/history2/" + y + "/" + m + "/" + d);
        fs3.once('value', function (snapshot) {
            var arr = snapshot.val();
            arr2 = genData2(arr)
            dataArray[9] = {
                data: genData(arr2),
                label: "Flow sensor 3",
                borderColor: "#AAFFAA",
                fill: false
            }
            console.log('plot new data')
            plotGraph(dataArray)
        });

        var controlArray = {};
        var r1 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay1/history/" + y + "/" + m + "/" + d);
        r1.once('value', function (snapshot) {
            var arr = snapshot.val();
            controlArray.relay1 = genData2(arr);


            $('#table_div1').find('tbody').empty();
            for (i = 0; i < controlArray.relay1.length; i++) {

                $('#table_div1 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay1[i]['t']) + '</td><td>' + controlArray.relay1[i]['type'] + '</td><td>' + controlArray.relay1[i]['oper'] + '</td></tr>');
            }

        });

        var r2 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay2/history/" + y + "/" + m + "/" + d);
        r2.once('value', function (snapshot) {
            var arr = snapshot.val();
            controlArray.relay2 = genData2(arr);
            $('#table_div2').find('tbody').empty();

            for (i = 0; i < controlArray.relay2.length; i++) {
                $('#table_div2 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay2[i]['t']) + '</td><td>' + controlArray.relay2[i]['type'] + '</td><td>' + controlArray.relay2[i]['oper'] + '</td></tr>');
            }
        });

        var r3 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay3/history/" + y + "/" + m + "/" + d);
        r3.once('value', function (snapshot) {
            var arr = snapshot.val();
            controlArray.relay3 = genData2(arr);
            $('#table_div3').find('tbody').empty();

            for (i = 0; i < controlArray.relay3.length; i++) {
                $('#table_div3 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay3[i]['t']) + '</td><td>' + controlArray.relay3[i]['type'] + '</td><td>' + controlArray.relay3[i]['oper'] + '</td></tr>');
            }
        });

        var r4 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay4/history/" + y + "/" + m + "/" + d);
        r4.once('value', function (snapshot) {
            var arr = snapshot.val();
            controlArray.relay4 = genData2(arr);
            $('#table_div4').find('tbody').empty();

            for (i = 0; i < controlArray.relay4.length; i++) {
                $('#table_div4 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay4[i]['t']) + '</td><td>' + controlArray.relay4[i]['type'] + '</td><td>' + controlArray.relay4[i]['oper'] + '</td></tr>');
            }
        });

        var r5 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay5/history/" + y + "/" + m + "/" + d);
        r5.once('value', function (snapshot) {
            var arr = snapshot.val();
            controlArray.relay5 = genData2(arr);
            $('#table_div5').find('tbody').empty();

            for (i = 0; i < controlArray.relay5.length; i++) {
                $('#table_div5 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay5[i]['t']) + '</td><td>' + controlArray.relay5[i]['type'] + '</td><td>' + controlArray.relay5[i]['oper'] + '</td></tr>');
            }
        });
        var r6 = firebase.database().ref("farmCode/" + '{{ farmCode }}' + "/logs/relay6/history/" + y + "/" + m + "/" + d);
        r6.once('value', function (snapshot) {
            var arr = snapshot.val();
            {#console.log(arr);#}
            controlArray['relay6'] = genData2(arr);
            $('#table_div6').find('tbody').empty();

            for (i = 0; i < controlArray.relay6.length; i++) {
                $('#table_div6 > tbody:last').append('<tr><td>' + convUnixToHMS(controlArray.relay6[i]['t']) + '</td><td>' + controlArray.relay6[i]['type'] + '</td><td>' + controlArray.relay6[i]['oper'] + '</td></tr>');
            }
        });


    }

    function UnixToDate(inputTime) {
        const unixTimestamp = inputTime;
        const milliseconds = unixTimestamp * 1000
        const dateObject = new Date(milliseconds)
        const humanDateFormat = dateObject.toLocaleString()
        return humanDateFormat
    }

    function genData(arr) {
        let returnArr = [];
        var i;
        for (i = 0; i < arr.length; i++) {
            {#console.log(arr[i])#}
            returnArr.push({'y': arr[i]['v'], 'x': UnixToDate(arr[i]['t'])})
        }
        return returnArr
    }

    function genData2(arr) {
        let returnArr = [];
        var i;
        {#console.log(arr)#}
        for (var key in arr) {
            {#console.log(arr[key]);#}
            returnArr.push(arr[key])
        }
        return returnArr
    }

    function plotGraph(dataArray) {
        var config = {
            type: 'line',
            data: {
                labels: [],
                datasets: dataArray
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        distribution: 'linear',
                    }],
                    title: {
                        display: false,
                    }
                },
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 0
                },
                hover: {
                    animationDuration: 0
                },
                responsiveAnimationDuration: 0,

            }
        };
        var ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, config);
    }

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: "AIzaSyCs9xyouIlR_7SBQwCpL_Bde22ZDC4vpWM",
        authDomain: "navitaiot.firebaseapp.com",
        databaseURL: "https://navitaiot.firebaseio.com",
        projectId: "navitaiot",
        storageBucket: "navitaiot.appspot.com",
        messagingSenderId: "840926440731",
        appId: "1:840926440731:web:9e7d0a635d9e89ff0db7be",
        measurementId: "G-5FY5JL3YN1"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();


</script>


</body>
</html>